# Ansible OpenSCAP Hardening

This project provides Ansible playbooks to scan and remediate systems using OpenSCAP and the SCAP Security Guide (SSG). The playbooks are designed to be adaptable to different Linux distributions.

## Overview

These playbooks help you automate the process of security compliance scanning and hardening. They are split into two main functions:

1.  **Scanning:** The `scan.yml` playbook scans your target systems against a defined security profile (defaulting to PCI-DSS) and generates reports.
2.  **Remediation:** The `remediate.yml` playbook uses the results from the scan to apply the necessary security remediations.

## Prerequisites

*   **Ansible:** You need to have Ansible installed on your control node.
*   **Inventory:** You must have an Ansible inventory file. A sample `inventory` file is provided. You need to edit this file to include your target hosts.
*   **SSH Access:** You need to have SSH access to the target hosts from your Ansible control node.

## Playbooks

### `scan.yml`

This playbook performs the following actions:
*   Installs OpenSCAP and the SCAP Security Guide on the target hosts.
*   Scans the hosts against a specified profile (defaults to PCI-DSS).
*   Generates an HTML report and an ARF (Asset Reporting Format) file for each host.
*   Fetches the HTML reports to the `reports/` directory on the control node.
*   Fetches the ARF files to the root directory on the control node.

### `remediate.yml`

This playbook performs the following actions:
*   Uses the ARF file generated by the `scan.yml` playbook to create a remediation playbook.
*   Runs the generated remediation playbook on the target hosts.
*   Checks if a reboot is required after applying the remediations and reboots the host if necessary.

## Usage

1.  **Create your inventory:**
    Edit the `inventory` file to add the hostnames or IP addresses of your target servers.

2.  **Run the scan:**
    ```bash
    ansible-playbook -i inventory scan.yml
    ```

3.  **Review the reports:**
    After the scan is complete, you can find the HTML reports in the `reports/` directory. Review these reports to understand the compliance status of your systems.

4.  **Apply remediations:**
    ```bash
    ansible-playbook -i inventory remediate.yml
    ```
    This will apply the remediations based on the scan results.

## Customization

### Changing the SCAP Profile

You can change the SCAP profile by editing the `profile` variable in the `scan.yml` playbook. To find the available profiles for your target OS, you can run the following command on the target host after installing `scap-security-guide`:

```bash
oscap info /usr/share/xml/scap/ssg/content/<your-ds-file>.xml
```

Replace `<your-ds-file>.xml` with the appropriate datastream file for your OS (e.g., `ssg-rhel8-ds.xml`).

## Supported Operating Systems

These playbooks are designed to work on the following OS families:

*   Red Hat (e.g., RHEL, CentOS, Fedora)
*   Debian (e.g., Debian, Ubuntu)

The playbooks will automatically detect the OS family and use the appropriate package names and file paths.
