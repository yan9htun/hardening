# Ansible OpenSCAP Hardening

This project provides Ansible playbooks to automate security scanning and remediation using OpenSCAP and the SCAP Security Guide (SSG). The playbooks are organized into scenarios to allow for easy expansion.

## Project Structure

```
.
├── README.md
├── inventory
└── scenarios/
    └── pci-dss/
        ├── scan.yml
        └── remediate.yml
```

## How it Works

The workflow is designed to be simple and effective:

1.  **Scan:** The `scan.yml` playbook is executed first. It installs the necessary tools on the target machines, runs the OpenSCAP scan against a specific security profile, and fetches the results back to your control node. The results consist of:
    *   An **HTML report** for human-readable analysis (e.g., `reports/report-server1.example.com.html`).
    *   An **ARF file**, which is an XML file containing the detailed scan results in a machine-readable format (e.g., `arf-server1.example.com.xml`).

2.  **Remediate:** The `remediate.yml` playbook takes the `arf-*.xml` file and uses it to automatically generate *another* Ansible playbook containing the remediation steps for that specific host. It then executes this newly generated playbook to apply the fixes and reboots the machine if required.

## Prerequisites

*   **Ansible:** Ansible must be installed on your control node.
*   **Inventory:** You must have an Ansible inventory file. A sample `inventory` file is provided with examples. You need to edit this file to include your target hosts.
*   **SSH Access:** You need passwordless SSH access to the target hosts from your control node (e.g., using SSH keys).

## Usage

**Step 1: Configure Your Inventory**

Edit the `inventory` file to add the hostnames or IP addresses of your target servers.

**Step 2: Run the Scan**

Run the `scan.yml` playbook from the appropriate scenario directory. For the PCI-DSS scenario:

```bash
ansible-playbook -i inventory scenarios/pci-dss/scan.yml
```

**Step 3: Review the Reports**

After the scan is complete, inspect the HTML reports in the `reports/` directory to understand the compliance status of your systems.

**Step 4: Apply Remediations**

This step uses the `arf-*.xml` files generated by the scan. These files must be present in the same directory from where you run the playbook.

```bash
ansible-playbook -i inventory scenarios/pci-dss/remediate.yml
```

## Customization

### Changing the SCAP Profile

You can change the security profile by editing the `profile` variable in the `scan.yml` file for the desired scenario. To find the available profiles for your target OS, you can run the following command on a target host after `scap-security-guide` is installed:

```bash
oscap info /usr/share/xml/scap/ssg/content/<your-ds-file>.xml
```

Replace `<your-ds-file>.xml` with the appropriate datastream file for your OS (e.g., `ssg-rhel8-ds.xml`).

### Adding New Scenarios

To add a new scenario (e.g., for CIS benchmarks), you can create a new directory under `scenarios/` and place your new `scan.yml` and `remediate.yml` playbooks inside it.

## Supported Operating Systems

These playbooks are designed to work on the following OS families:

*   **Red Hat** (e.g., RHEL, CentOS, Fedora)
*   **Debian** (e.g., Debian, Ubuntu)

The playbooks will automatically detect the OS family and use the appropriate package names and file paths. If you run them on an unsupported OS, the playbook will stop and inform you.
